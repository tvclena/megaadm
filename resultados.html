<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mega da Virada â€¢ Resultados</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;font-family:Inter,system-ui}
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
}

/* HEADER */
header{
  padding:16px;
  text-align:center;
  border-bottom:1px solid #2a2200;
  color:#d4af37;
  font-weight:700;
}

/* CONTAINER */
.container{
  padding:14px;
  display:grid;
  gap:14px;
}

/* CARD */
.card{
  background:#141414;
  border:1px solid #2a2200;
  border-radius:16px;
  padding:14px;
}

/* NUMEROS */
.numeros{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:8px;
}
.num{
  width:36px;height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#222;
  border:1px solid #333;
  font-size:14px;
}
.num.hit{
  background:#22c55e;
  color:#000;
  font-weight:700;
}

/* METRICAS */
.metricas{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.met{
  background:#111;
  border:1px solid #333;
  border-radius:12px;
  padding:10px;
  text-align:center;
  font-size:13px;
}
.met strong{
  color:#d4af37;
  font-size:18px;
}

/* JOGOS */
.jogo{
  margin-top:10px;
}
.jogo small{
  opacity:.7;
}
</style>
</head>

<body>

<header>ðŸŽ† Mega da Virada â€¢ Resultados</header>

<div class="container">

  <!-- RESULTADO -->
  <div class="card">
    <h3>NÃºmeros Sorteados</h3>
    <div class="numeros" id="resultado"></div>
  </div>

  <!-- METRICAS -->
  <div class="card">
    <h3>MÃ©tricas</h3>
    <div class="metricas" id="metricas"></div>
  </div>

  <!-- JOGOS -->
  <div id="jogos"></div>

</div>

<script>
const db = supabase.createClient(
  'https://dxkszikemntfusfyrzos.supabase.co',
  'sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed'
);

const resultadoDiv = document.getElementById('resultado');
const metricasDiv = document.getElementById('metricas');
const jogosDiv = document.getElementById('jogos');

let resultado = [];
let jogos = [];
let carregando = false;

/* CARREGA RESULTADO */
async function carregarResultado(){
  const { data } = await db
    .from('mega_resultado')
    .select('*')
    .order('created_at',{ascending:false})
    .limit(1)
    .single();

  resultado = data?.numeros || [];
}

/* CARREGA JOGOS */
async function carregarJogos(){
  const { data } = await db
    .from('mega_jogos')
    .select('*')
    .order('codigo');

  jogos = data || [];
}

/* RENDER */
function render(){
  // Resultado
  resultadoDiv.innerHTML='';
  resultado.forEach(n=>{
    const el = document.createElement('div');
    el.className='num hit';
    el.textContent=String(n).padStart(2,'0');
    resultadoDiv.appendChild(el);
  });

  // Jogos + mÃ©tricas
  jogosDiv.innerHTML='';
  metricasDiv.innerHTML='';
  const contagem = {0:0,1:0,2:0,3:0,4:0,5:0,6:0};

  jogos.forEach(j=>{
    const acertos = j.numeros.filter(n=>resultado.includes(n)).length;
    contagem[acertos]++;

    jogosDiv.innerHTML += `
      <div class="card jogo">
        <strong>${j.codigo}</strong>
        <div class="numeros">
          ${j.numeros.map(n=>`
            <div class="num ${resultado.includes(n)?'hit':''}">
              ${String(n).padStart(2,'0')}
            </div>
          `).join('')}
        </div>
        <small>Acertos: ${acertos}</small>
      </div>
    `;
  });

  Object.keys(contagem).forEach(k=>{
    metricasDiv.innerHTML += `
      <div class="met">
        <strong>${contagem[k]}</strong><br>${k} acertos
      </div>
    `;
  });
}

/* INIT + POLLING */
async function init(){
  if(carregando) return;
  carregando = true;

  await carregarResultado();
  await carregarJogos();
  render();

  carregando = false;
}

init();
setInterval(init, 3000);
</script>

</body>
</html>
