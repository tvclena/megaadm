<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>ADM Mega da Virada</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:Inter,system-ui;
}
header{
  padding:16px;
  text-align:center;
  color:#d4af37;
  border-bottom:1px solid #333;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#d4af37;
  color:#000;
  font-weight:700;
  font-size:15px;
}
.lista{
  padding:14px;
  display:grid;
  gap:12px;
}
.card{
  background:#141414;
  border-radius:14px;
  padding:12px;
}
.num{
  width:32px;height:32px;
  border-radius:50%;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  margin:4px;
  background:#222;
}
.num.hit{
  background:#22c55e;
  color:#000;
  font-weight:700;
}

/* MODAL */
.overlay{
  position:fixed;
  inset:0;
  background:#000c;
  display:none;
  align-items:center;
  justify-content:center;
}
.modal{
  background:#141414;
  padding:20px;
  border-radius:14px;
  width:260px;
}
.modal input{
  width:100%;
  padding:14px;
  font-size:18px;
  text-align:center;
  border-radius:10px;
  border:1px solid #333;
  background:#0f0f0f;
  color:#fff;
}
</style>
</head>

<body>

<header>ðŸŽ¯ ADM Mega da Virada</header>

<div class="lista">
  <button onclick="abrir()">Inserir NÃºmero</button>
  <div id="resultado"></div>
  <div id="jogos"></div>
</div>

<div class="overlay" id="overlay">
  <div class="modal">
    <input id="numero" type="number" min="1" max="60" placeholder="1 a 60">
    <button onclick="salvar()">Confirmar</button>
  </div>
</div>

<script>
const db = supabase.createClient(
  'https://dxkszikemntfusfyrzos.supabase.co',
  'sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed'
);

let resultado = [];

/* MODAL */
function abrir(){ overlay.style.display='flex'; numero.value=''; }
function fechar(){ overlay.style.display='none'; }

/* BUSCA RESULTADO */
async function carregarResultado(){
  const {data} = await db
    .from('mega_resultado')
    .select('*')
    .order('created_at',{ascending:false})
    .limit(1)
    .single();

  resultado = data?.numeros || [];
  resultadoDiv.innerHTML = resultado.map(n=>`<span class="num hit">${n}</span>`).join('');
}

/* SALVAR NÃšMERO */
async function salvar(){
  const n = parseInt(numero.value);
  if(!n || n<1 || n>60) return alert('NÃºmero invÃ¡lido');
  if(resultado.includes(n)) return alert('JÃ¡ inserido');
  if(resultado.length>=6) return alert('Resultado completo');

  const novo = [...resultado, n];

  if(resultado.length===0){
    await db.from('mega_resultado').insert({numeros:novo});
  }else{
    const {data} = await db
      .from('mega_resultado')
      .select('id')
      .order('created_at',{ascending:false})
      .limit(1)
      .single();

    await db.from('mega_resultado').update({numeros:novo}).eq('id',data.id);
  }

  fechar();
  init();
}

/* JOGOS */
async function carregarJogos(){
  const {data} = await db.from('mega_jogos').select('*').order('codigo');
  jogos.innerHTML='';
  data.forEach(j=>{
    jogos.innerHTML+=`
      <div class="card">
        <strong>${j.codigo}</strong><br>
        ${j.numeros.map(n=>`<span class="num ${resultado.includes(n)?'hit':''}">${n}</span>`).join('')}
      </div>
    `;
  });
}

async function init(){
  await carregarResultado();
  await carregarJogos();
}

init();

/* REALTIME */
db.channel('mega')
.on('postgres_changes',{event:'INSERT',schema:'public',table:'mega_resultado'},init)
.on('postgres_changes',{event:'UPDATE',schema:'public',table:'mega_resultado'},init)
.subscribe();
</script>

</body>
</html>
