<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>ADM â€¢ Mega da Virada</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;font-family:Inter,system-ui}
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
}

/* HEADER */
header{
  padding:16px;
  text-align:center;
  border-bottom:1px solid #2a2200;
  color:#d4af37;
  font-weight:700;
}

/* CONTAINER */
.container{
  padding:14px;
  display:grid;
  gap:14px;
}

/* BUTTON */
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#d4af37;
  color:#000;
  font-weight:700;
  font-size:15px;
  cursor:pointer;
}

/* CARD */
.card{
  background:#141414;
  border:1px solid #2a2200;
  border-radius:16px;
  padding:14px;
}

/* NUMEROS */
.numeros{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:8px;
}
.num{
  width:36px;height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#222;
  border:1px solid #333;
  font-size:14px;
  cursor:pointer;
}
.num.hit{
  background:#22c55e;
  color:#000;
  font-weight:700;
}

/* METRICAS */
.metricas{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.met{
  background:#111;
  border:1px solid #333;
  border-radius:12px;
  padding:10px;
  text-align:center;
  font-size:13px;
}
.met strong{color:#d4af37;font-size:18px}

/* MODAL */
.overlay{
  position:fixed;
  inset:0;
  background:#000c;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}
.modal{
  background:#141414;
  padding:20px;
  border-radius:16px;
  width:260px;
  border:1px solid #333;
}
.modal input{
  width:100%;
  padding:14px;
  font-size:18px;
  text-align:center;
  border-radius:10px;
  border:1px solid #333;
  background:#0f0f0f;
  color:#fff;
}
</style>
</head>

<body>

<header>ðŸŽ¯ ADM Mega da Virada</header>

<div class="container">

  <!-- CONTROLE -->
  <div class="card">
    <button onclick="abrirModal()">Inserir NÃºmero</button>
    <div class="numeros" id="resultado"></div>
    <small style="opacity:.6">Duplo clique remove o nÃºmero</small>
  </div>

  <!-- METRICAS -->
  <div class="card">
    <h3>MÃ©tricas</h3>
    <div class="metricas" id="metricas"></div>
  </div>

  <!-- JOGOS -->
  <div id="jogos"></div>

</div>

<!-- MODAL -->
<div class="overlay" id="overlay">
  <div class="modal">
    <input id="numeroInput" type="number" min="1" max="60" placeholder="1 a 60">
    <button onclick="salvarNumero()">Confirmar</button>
  </div>
</div>

<script>
const db = supabase.createClient(
  'https://dxkszikemntfusfyrzos.supabase.co',
  'sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed'
);

const resultadoDiv = document.getElementById('resultado');
const jogosDiv = document.getElementById('jogos');
const metricasDiv = document.getElementById('metricas');

let resultado = [];
let jogos = [];
let carregando = false;

/* MODAL */
function abrirModal(){
  overlay.style.display='flex';
  numeroInput.value='';
}
function fecharModal(){
  overlay.style.display='none';
}

/* CARREGA RESULTADO */
async function carregarResultado(){
  const { data } = await db
    .from('mega_resultado')
    .select('*')
    .order('created_at',{ascending:false})
    .limit(1)
    .single();

  resultado = data?.numeros || [];
}

/* CARREGA JOGOS */
async function carregarJogos(){
  const { data } = await db
    .from('mega_jogos')
    .select('*')
    .order('codigo');

  jogos = data || [];
}

/* SALVAR NUMERO */
async function salvarNumero(){
  const n = parseInt(numeroInput.value);
  if(!n || n<1 || n>60) return alert('NÃºmero invÃ¡lido');
  if(resultado.includes(n)) return alert('JÃ¡ inserido');
  if(resultado.length>=6) return alert('Resultado completo');

  const novo = [...resultado, n];

  if(resultado.length===0){
    await db.from('mega_resultado').insert({numeros:novo});
  }else{
    const { data } = await db
      .from('mega_resultado')
      .select('id')
      .order('created_at',{ascending:false})
      .limit(1)
      .single();

    await db.from('mega_resultado').update({numeros:novo}).eq('id',data.id);
  }

  fecharModal();
  init();
}

/* REMOVER NUMERO (DUPLO CLIQUE) */
async function removerNumero(n){
  const novo = resultado.filter(x=>x!==n);
  const { data } = await db
    .from('mega_resultado')
    .select('id')
    .order('created_at',{ascending:false})
    .limit(1)
    .single();

  await db.from('mega_resultado').update({numeros:novo}).eq('id',data.id);
  init();
}

/* RENDER */
function render(){
  // Resultado
  resultadoDiv.innerHTML='';
  resultado.forEach(n=>{
    const el = document.createElement('div');
    el.className='num hit';
    el.textContent=String(n).padStart(2,'0');
    el.ondblclick=()=>removerNumero(n);
    resultadoDiv.appendChild(el);
  });

  // Jogos
  jogosDiv.innerHTML='';
  const contagem = {0:0,1:0,2:0,3:0,4:0,5:0,6:0};

  jogos.forEach(j=>{
    const acertos = j.numeros.filter(n=>resultado.includes(n)).length;
    contagem[acertos]++;

    jogosDiv.innerHTML+=`
      <div class="card">
        <strong>${j.codigo}</strong>
        <div class="numeros">
          ${j.numeros.map(n=>`
            <div class="num ${resultado.includes(n)?'hit':''}">
              ${String(n).padStart(2,'0')}
            </div>
          `).join('')}
        </div>
        <small>Acertos: ${acertos}</small>
      </div>
    `;
  });

  // MÃ©tricas
  metricasDiv.innerHTML='';
  Object.keys(contagem).forEach(k=>{
    metricasDiv.innerHTML+=`
      <div class="met">
        <strong>${contagem[k]}</strong><br>${k} acertos
      </div>
    `;
  });
}

/* INIT + POLLING */
async function init(){
  if(carregando) return;
  carregando=true;

  await carregarResultado();
  await carregarJogos();
  render();

  carregando=false;
}

init();
setInterval(init, 3000);
</script>

</body>
</html>
